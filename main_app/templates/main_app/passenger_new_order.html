{% extends 'main_app/base.html' %}
{% load crispy_forms_filters %}
{% load bootstrap5 %}

{% block head %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/features.css' %}">
    <link rel="stylesheet" href="{% static 'css/main_styling.css' %}">
    <style>
        #map {
            height: 500px;
            width: 100%;
        }

        .user_card {
            width: 90%;
            color: white;
        }
    </style>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
    <script src="{% static '/js/maps.js' %}"></script>
    {% if order %}
        <script type='text/javascript'>
            {% if order.start_location_lat and order.start_location_lon and order.destination_lat and order.destination_lon %}
                setup({{ order.start_location_lat }}, {{ order.start_location_lon }}, {{ order.destination_lat }}, {{ order.destination_lon}});
            {% elif order.start_location_lat and order.start_location_lon %}
                setup({{ order.start_location_lat }}, {{ order.start_location_lon }}, null, null);
            {% elif order.destination_lat and order.destination_lon %}
                setup(null, null, {{ order.destination_lat }}, {{ order.destination_lon}});
            {% endif %}
        </script>
    {% endif %}
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&callback=initMap"></script>
{% endblock %}

{% block content %}
        {% load crispy_forms_tags %}
    <div class="container h-100">
        <div class="d-flex justify-content-center h-100">
            <div class="user_card">
                <div class="row">
                    <div class="col">
                        {% if form %}
                            <h1 class="text-center m-4 fw-light">New order</h1>
                            <div class="d-flex justify-content-center form_container align-self-center">
                                <form action="/passenger_start_order/" method="post">
                                    {% csrf_token %}
                                    {{ form|crispy }}
                                    <div class="d-flex justify-content-center mt-3 login_container">
                                        <input type="submit" class="btn login_btn" value="Submit">
                                    </div>
                                </form>
                            </div>
                        {% else %}
                            <h1 class="text-center m-4 fw-light">Order Details</h1>
                            <div class="justify-content-center" style="margin-left: 30px">
                            <p class=""><strong>Start Location:</strong>
                                ({{ order.start_location_lat }}, {{ order.start_location_lon }})</p>
                            <p class=""><strong>Destination:</strong>
                                ({{ order.destination_lat }}, {{ order.destination_lon }})</p>
                            <p class=""><strong>Price:</strong> {{ order.price }}</p>
                            <p class=""><strong>Driver Name:</strong> {{ order.driver.user.username }}</p>
                            <p class=""><strong>Order status:</strong> {{ order_status_label }}</p>
                            </div>
                            <form action="" method="POST">
                                {% csrf_token %}
                                {% if order.status == 0 %}
                                    <div class="d-flex justify-content-center mt-3 login_container">
                                    <button name='button' class="btn login_btn" type='submit' value="CANCEL"> Cancel</button>
                                    </div>
                                {% endif %}
                                {% if order.status == 1 %}
                                    <div class="d-flex justify-content-center mt-3 login_container">
                                    <button name='button' class="btn login_btn" type='submit' value="CANCEL"> Cancel</button>
                                    </div>
                                {% endif %}
                                {% if order.status == 2 %}
                                    <div class="d-flex justify-content-center mt-3 login_container">
                                    <button name='button' class="btn login_btn" type='submit' value="CANCEL"> Cancel</button>
                                    </div>
                                    <div class="d-flex justify-content-center mt-3 login_container">
                                    <button name='button' class="btn login_btn" type='submit' value="COMPLETE"> Complete</button>
                                    </div>
                                {% endif %}
                            </form>
                        {% endif %}
                    </div>

                    <div class="col">
                        <h1 class="text-center m-4 fw-light">Map</h1>
                        <div class="pageholder" style="margin-bottom: 25px; margin-right: 25px;">
                            <!-- Map -->
                            <div id="map"></div>
                        </div>
                    </div>
                </div>
{% endblock %}